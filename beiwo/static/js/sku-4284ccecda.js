var SKU={init:function(){$("body").on("click","#SKUbox .cartbox .typebox .property .main .list a:not(.disabled)",function(t){t.preventDefault(),$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected").siblings().removeClass("selected"),SKU.check($("#SKUbox").data("info").skulist),$("#SKUbox .typebox .main .changenum  input").val(1),$("#SKUbox .typebox .main .changenum .minus").addClass("disabled"),1==$("#SKUbox .topbox .cartchoose .messbox .stock > span").text()?$("#SKUbox .typebox .main .changenum .plus").addClass("disabled"):$("#SKUbox .typebox .main .changenum .plus").removeClass("disabled")}),$("#SKUbox").on("click",".weui-popup__overlay",function(t){t.preventDefault(),$(" body .cart-box").remove()}),$("body").on("input","#SKUbox .typebox .main .changenum  input",function(t){var a=Number($(this).val()),s=$("#SKUbox .topbox .cartchoose .messbox .stock > span").text();/^\+?[1-9]\d*$/.test(a)?a<s?($(this).parent().find(".plus,.minus").removeClass("disabled"),a<=1&&$(this).parent().find(".minus").addClass("disabled")):(a=s,$(this).parent().find(".plus").addClass("disabled"),a<=1?$(this).parent().find(".minus").addClass("disabled"):$(this).parent().find(".minus").removeClass("disabled")):(a=0,$(this).parent().find(".minus").addClass("disabled"),$(this).parent().find(".plus").removeClass("disabled")),$(this).val(a)}),$("body").on("blur","#SKUbox .typebox .main .changenum  input",function(t){0==$(this).val()&&$(this).val(1),window.scroll(0,0)}),$("body").on("click","#SKUbox .typebox .main .changenum  a:not(.disabled)",function(t){t.preventDefault();var a=~~$(this).siblings("input:not(.stock)").val(),s=$("#SKUbox .topbox .cartchoose .messbox .stock > span").text();$(this).hasClass("minus")?a-=1:a+=1,a<1&&(a=1),s<=a?($(this).parent().find(".plus").addClass("disabled"),s<a&&(a-=1)):$(this).parent().find(".plus").removeClass("disabled"),1==a?$(this).parent().find(".minus").addClass("disabled"):$(this).parent().find(".minus").removeClass("disabled"),$(this).siblings("input:not(.stock)").val(a)})},show:function(d){$.ajax({url:API.url()+"goods/info/sku",data:{goodsid:d.info.goodsid},async:!1}).done(function(n){if(API.checkCallback(n)){if($("body").append(API.template("sku.art",d)),$.hideLoading(),$("#SKUbox").on("click",".weui-popup__overlay,.close-popup",function(t){t.preventDefault(),setTimeout(function(){$(".cart-box").remove()},150),$("body").unbind("touchmove")}),$("#SKUbox").popup("open"),$("body").bind("touchmove",function(t){t.preventDefault()}),$("#SKUbox").data("info",n.data),d.noxiusku){var t=d.noxiusku.split("_"),a=[];for(var s in d.info.skuattr)a.push(d.info.skuattr[s]);for(var e in t){var o=$.inArray(t[e],a[e]);$("#SKUbox .cartbox .property .main:eq("+e+") .list a:eq("+o+")").addClass("selected").siblings().removeClass("selected")}}SKU.check(n.data.skulist),$("#SKUbox .cartbox .btns .submit").click(function(t){var s=!0;$("#SKUbox .cartbox .property .main").each(function(t,a){0==$(this).find(".list a.selected").length&&(s=!1)});var a=$("#SKUbox").data("sku"),e=$("#SKUbox").data("price");if(s){var o=~~$("#SKUbox .typebox .main .changenum input:not(.stock)").val(),i=n.data.skulist[a].stock;if(d.isHaveCount){if(i<o)return void $.toast("库存数量不足","text")}else if(d.count>i)return void $.toast("库存数量不足","text");d.isHaveCount?d.callback(a,o):d.callback(a,i,e),$("#SKUbox .weui-popup__overlay").click()}else $.toast("商品属性请选择完整","text")})}})},check:function(i){var e=[],o=!0,n="";$("#SKUbox .cartbox .property .main").each(function(t,a){if(0!=$(this).find(".list a.selected").length){var s=$(this).find(".list a.selected").data("val");e.push($(this).find(".list a.selected").data("val")),n+=s+" ",o=!1}else e.push("-")}),"-"==(e=o?"-":e.join("_"))?$("#SKUbox .topbox .cartchoose .messbox .tips").html(""):$("#SKUbox .topbox .cartchoose .messbox .tips").html("已选“"+n+"”"),$("#SKUbox").data("sku",e);var t=i[e].minprice==i[e].maxprice?(i[e].minprice/100).toFixed(2):(i[e].minprice/100).toFixed(2)+"~"+(i[e].maxprice/100).toFixed(2);$("#SKUbox").data("price",t),$("#SKUbox .topbox .cartchoose .messbox .price > span").text(t),$("#SKUbox .topbox .cartchoose .messbox .stock > span").text(i[e].stock),$("#SKUbox .cartbox .property .main .list a").removeClass("disabled");var s=0,d=0;$("#SKUbox .cartbox .property .main").each(function(t,a){0==$(this).find(".list a.selected").length&&(s+=1,d=t)}),1==s&&$("#SKUbox .cartbox .property .main:eq("+d+") .list a").each(function(t,a){var s=[],e=$(this).data("val");$("#SKUbox .cartbox .property .main").each(function(t,a){t!=d?s.push($(this).find(".list a.selected").data("val")):s.push(e)}),0==i[s.join("_")].stock&&$(this).addClass("disabled")}),0==s&&$("#SKUbox .cartbox .property .main").each(function(t,a){var o=t;$("#SKUbox .cartbox .property .main:eq("+t+") .list a:not(.selected)").each(function(t,a){var s=[],e=$(this).data("val");$("#SKUbox .cartbox .property .main").each(function(t,a){t!=o?s.push($(this).find(".list a.selected").data("val")):s.push(e)}),0==i[s.join("_")].stock&&$(this).addClass("disabled")})})}};